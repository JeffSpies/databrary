<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Frontend Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: volume/filter.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Generated by CoffeeScript 1.12.7

/**
 * Volume filter
 * @module
 */
'use strict';
app.directive('slotFilter', [
  'constantService', function(constants) {
    return {
      restrict: 'E',
      templateUrl: 'volume/filter.html',
      link: function($scope) {
        var filter, join, make, makeFilter, old, ops;
        filter = $scope.filter;
        join = function(o, op, e) {
          if (o) {
            return o + op + e;
          } else {
            return e;
          }
        };
        ops = {
          '': function(o) {
            return o;
          },
          any: function(o) {
            return o || 'false';
          },
          "true": function(o) {
            return join(o, '&amp;&amp;', '!v');
          },
          "false": function(o) {
            return join(o, '&amp;&amp;', 'v');
          },
          two: function(o) {
            return join(o, '&amp;&amp;', 'v!==2');
          },
          eq: function(o, x) {
            return join(o, '&amp;&amp;', x ? 'v!=' + JSON.stringify(x) : 'v');
          },
          ne: function(o, x) {
            return join(o, '||', 'v==' + JSON.stringify(x));
          },
          gt: function(o, x) {
            return join(o, '||', 'v&lt;=' + JSON.stringify(x));
          },
          ge: function(o, x) {
            return join(o, '||', 'v&lt;' + JSON.stringify(x));
          },
          lt: function(o, x) {
            return join(o, '||', 'v>=' + JSON.stringify(x));
          },
          le: function(o, x) {
            return join(o, '||', 'v>' + JSON.stringify(x));
          },
          contains: function(o, x) {
            return join(o, '||', '!(v&amp;&amp;v.includes(' + JSON.stringify(x) + '))');
          }
        };
        makeFilter = function(key) {
          var any, c, cats, ci, e, exp, f, indicate, j, len, m, mets, record, ref, ref1;
          exp = ['var v,i,c'];
          cats = {
            slot: {}
          };
          ci = 0;
          any = false;
          ref = filter.list;
          for (j = 0, len = ref.length; j &lt; len; j++) {
            f = ref[j];
            if (!f.op) {
              continue;
            }
            any = true;
            c = f.category.id;
            if (!(c in cats)) {
              cats[c] = {
                $index: ci++
              };
            }
            m = f.metric.id;
            cats[c][m] = ops[f.op](cats[c][m], f.value);
          }
          if (!any) {
            return;
          }
          indicate = function(mets, any) {
            mets.indicator = ops[any ? 'two' : 'any'](mets.indicator);
            return any;
          };
          record = function(mets, rv, age, brk) {
            var e;
            any = false;
            for (m in mets) {
              e = mets[m];
              if (!(e &amp;&amp; m !== '$index' &amp;&amp; m !== 'indicator')) {
                continue;
              }
              any = true;
              if (m === 'age') {
                exp.push('v=' + age);
              } else {
                exp.push('v=' + rv + '.measures[' + m + ']');
                if (constants.metric[m].assumed) {
                  exp.push('if(v==null)v=' + JSON.stringify(constants.metric[m].assumed));
                }
              }
              exp.push('if(' + e + ')' + brk);
            }
            return indicate(mets, any);
          };
          if (key &amp;&amp; key !== 'slot') {
            if (mets = cats[key]) {
              exp.push('if(x){');
              exp.push('v=' + (record(mets, 'x', 'undefined', 'return') ? 2 : 1));
              exp.push('}else v=0', 'if(' + mets.indicator + ')return');
            }
            if (Object.keys(mets = cats.slot).length) {
              exp.push('c=0', 'for(i=0;i&lt;y.length;i++){c=1');
              any = false;
              for (m in mets) {
                e = mets[m];
                if (!(e &amp;&amp; m !== 'indicator')) {
                  continue;
                }
                any = true;
                exp.push('v=y[i].' + m, 'if(' + e + ')continue');
              }
              if (indicate(mets, any)) {
                exp.push('c=2', 'break');
              }
              exp.push('}', 'v=c', 'if(' + mets.indicator + ')return');
            }
          } else {
            ref1 = cats.slot;
            for (m in ref1) {
              e = ref1[m];
              if (e) {
                exp.push('v=x.' + m, 'if(' + e + ')return');
              }
            }
            if (ci) {
              exp.push('var r');
              exp.push('c=new Uint8Array(new ArrayBuffer(' + ci + '))', 'for(i=0;i&lt;y.length;i++){if(!(r=y[i].record)){continue');
              for (c in cats) {
                mets = cats[c];
                if (!(c !== 'slot')) {
                  continue;
                }
                exp.push('}else if(r.category===' + c + '){if(!c[' + mets.$index + '])c[' + mets.$index + ']=1');
                if (record(mets, 'r', 'y[i].age', 'continue')) {
                  exp.push('c[' + mets.$index + ']=2');
                }
              }
              exp.push('}}');
              for (c in cats) {
                mets = cats[c];
                if (c !== 'slot') {
                  exp.push('v=c[' + mets.$index + ']', 'if(' + mets.indicator + ')return');
                }
              }
            }
          }
          exp.push('return true;');
          exp = exp.join(';');
          if (DEBUG) {
            console.log(exp);
          }
          return exp;
        };
        make = function(f) {
          return f &amp;&amp; new Function('x', 'y', f);
        };
        old = void 0;
        filter.make = function(key) {
          return make(old = makeFilter(key || this.key));
        };
        filter.change = function() {
          var f;
          f = makeFilter(this.key);
          if (f === old) {
            return;
          }
          old = f;
          filter.update(make(f));
        };
        filter.remove = function(i) {
          this.list.splice(i, 1);
          return filter.change();
        };
        $scope.filterCompleter = function(f, input) {
          var i, j, len, match, o, results;
          i = input.toLowerCase();
          match = (function() {
            var j, len, ref, results;
            ref = f.metric.options;
            results = [];
            for (j = 0, len = ref.length; j &lt; len; j++) {
              o = ref[j];
              if (o.toLowerCase().startsWith(i)) {
                results.push(o);
              }
            }
            return results;
          })();
          switch (match.length) {
            case 0:
              return input;
            case 1:
              return match[0];
            default:
              results = [];
              for (i = j = 0, len = match.length; j &lt; len; i = ++j) {
                o = match[i];
                results.push({
                  text: o,
                  select: function() {
                    f.value = this.text;
                    filter.change();
                    return this.text;
                  },
                  "default": input &amp;&amp; i === 0
                });
              }
              return results;
          }
        };
        filter.change();
      }
    };
  }
]);

//# sourceMappingURL=filter.js.map
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Back to Homepage</a></h2><h3>Directives</h3><ul><li><a href="module-directive_clickElsewhere.html">directive/clickElsewhere</a></li><li><a href="module-directive_form.html">directive/form</a></li><li><a href="module-site_activity.html">site/activity</a></li><li><a href="module-site_activityChange.html">site/activityChange</a></li><li><a href="module-site_commentReply.html">site/commentReply</a></li><li><a href="module-site_displayAge.html">site/displayAge</a></li><li><a href="module-site_errors.html">site/errors</a></li><li><a href="module-site_figure.html">site/figure</a></li><li><a href="module-site_frame.html">site/frame</a></li><li><a href="module-site_inputAge.html">site/inputAge</a></li><li><a href="module-site_inputCompleter.html">site/inputCompleter</a></li><li><a href="module-volume_accessGrant.html">volume/accessGrant</a></li><li><a href="module-volume_accessSearch.html">volume/accessSearch</a></li><li><a href="module-volume_assist.html">volume/assist</a></li><li><a href="module-volume_cite.html">volume/cite</a></li><li><a href="module-volume_comments.html">volume/comments</a></li><li><a href="module-volume_design.html">volume/design</a></li><li><a href="module-volume_editAccess.html">volume/editAccess</a></li><li><a href="module-volume_editFunding.html">volume/editFunding</a></li><li><a href="module-volume_editLinks.html">volume/editLinks</a></li><li><a href="module-volume_editOverview.html">volume/editOverview</a></li><li><a href="module-volume_excerpts.html">volume/excerpts</a></li><li><a href="module-volume_filter.html">volume/filter</a></li><li><a href="module-volume_fundingGrant.html">volume/fundingGrant</a></li><li><a href="module-volume_fundingSearch.html">volume/fundingSearch</a></li><li><a href="module-volume_list.html">volume/list</a></li><li><a href="module-volume_metadata.html">volume/metadata</a></li><li><a href="module-volume_meter.html">volume/meter</a></li><li><a href="module-volume_meterCanvas.html">volume/meterCanvas</a></li><li><a href="module-volume_overview.html">volume/overview</a></li><li><a href="module-volume_owners.html">volume/owners</a></li><li><a href="module-volume_pivot.html">volume/pivot</a></li><li><a href="module-volume_showInvestigators.html">volume/showInvestigators</a></li><li><a href="module-volume_slot.html">volume/slot</a></li><li><a href="module-volume_spreadsheet.html">volume/spreadsheet</a></li></ul><h3>Services</h3><ul><li><a href="analyticService.html">analyticService</a></li><li><a href="authService.html">authService</a></li><li><a href="constantService.html">constantService</a></li><li><a href="displayService.html">displayService</a></li><li><a href="messageService.html">messageService</a></li></ul><h3>Controllers</h3><ul><li><a href="site_home.html">site/home</a></li><li><a href="volume_activity.html">volume/activity</a></li><li><a href="volume_csv.html">volume/csv</a></li><li><a href="volume_edit.html">volume/edit</a></li><li><a href="volume_search.html">volume/search</a></li><li><a href="volume_slotActivity.html">volume/slotActivity</a></li><li><a href="volume_view.html">volume/view</a></li><li><a href="volume_zip.html">volume/zip</a></li></ul><h3>Functions</h3><ul><li><a href="-_anonymous_-pre-checkDirty.html">checkDirty</a></li><li><a href="-_anonymous_-pre-form.$setUnsubmitted.html">$setUnsubmitted</a></li><li><a href="-_anonymous_-pre-form.resetAll.html">resetAll</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu May 17 2018 12:01:00 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
