<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Frontend Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: volume/design.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Generated by CoffeeScript 1.12.7

/**
 * The volume design tab functionalities
 * @module
 */
'use strict';
app.directive('volumeDesign', [
  '$location', 'constantService', 'routerService', 'messageService', function($location, constants, router, messages) {
    return {
      restrict: 'E',
      templateUrl: 'volume/design.html',
      require: '^wizard',
      link: function($scope, $element, $attrs, wizard) {
        var form, init, volume;
        volume = $scope.volume;
        form = $scope.volumeDesign;
        $element.on('click', function(e) {
          angular.element(e.target).not('input').closest('li.clickable').find('input').trigger('click');
        });
        $scope.select = function(c) {
          var j, k, len, len1, m, ref, ref1;
          form.metric = {};
          if (($scope.selected = constants.category[c]) == null) {
            return;
          }
          $location.replace().search('key', void 0);
          if (volume.metrics[c]) {
            ref = volume.metrics[c];
            for (j = 0, len = ref.length; j &lt; len; j++) {
              m = ref[j];
              form.metric[m] = true;
            }
          } else {
            ref1 = $scope.selected.metrics;
            for (k = 0, len1 = ref1.length; k &lt; len1; k++) {
              m = ref1[k];
              if (m.required != null) {
                form.metric[m.id] = true;
              }
            }
          }
        };
        init = function() {
          var c, ref;
          form.category = {};
          for (c in volume.metrics) {
            form.category[c] = true;
          }
          $scope.select(((ref = $scope.selected) != null ? ref.id : void 0) || $location.search().key);
        };
        init();
        $scope.change = function(c, m) {
          var i, s;
          if (c == null) {
            return;
          }
          messages.clear(form);
          form.$setSubmitted();
          volume.setVolumeMetrics(c, m, m != null ? form.metric[m] : form.category[c]).then(function() {
            init();
            form.$setPristine();
          }, function(res) {
            init();
            form.$setUnsubmitted();
            messages.addError({
              body: 'Error changing volume design',
              report: res,
              owner: form
            });
          });
          if (!((m != null) &amp;&amp; (i = $scope.selected.indicator) &amp;&amp; m !== i.id)) {
            return;
          }
          if (form.metric[m]) {
            s = false;
          } else if (!_.some(form.metric)) {
            s = true;
          } else {
            return;
          }
          i = i.id;
          if (form.metric[i] !== s) {
            form.metric[i] = s;
            $scope.change(c, i);
          }
        };
        $scope.manage = function() {
          $location.replace().search('key', $scope.selected.id);
          wizard.activateStep('data');
        };
        return $scope.stop = function(e) {
          e.stopPropagation();
          return false;
        };
      }
    };
  }
]);

//# sourceMappingURL=design.js.map
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Back to Homepage</a></h2><h3>Directives</h3><ul><li><a href="module-directive_clickElsewhere.html">directive/clickElsewhere</a></li><li><a href="module-directive_form.html">directive/form</a></li><li><a href="module-site_activity.html">site/activity</a></li><li><a href="module-site_activityChange.html">site/activityChange</a></li><li><a href="module-site_commentReply.html">site/commentReply</a></li><li><a href="module-site_displayAge.html">site/displayAge</a></li><li><a href="module-site_errors.html">site/errors</a></li><li><a href="module-site_figure.html">site/figure</a></li><li><a href="module-site_frame.html">site/frame</a></li><li><a href="module-site_inputAge.html">site/inputAge</a></li><li><a href="module-site_inputCompleter.html">site/inputCompleter</a></li><li><a href="module-volume_accessGrant.html">volume/accessGrant</a></li><li><a href="module-volume_accessSearch.html">volume/accessSearch</a></li><li><a href="module-volume_assist.html">volume/assist</a></li><li><a href="module-volume_cite.html">volume/cite</a></li><li><a href="module-volume_comments.html">volume/comments</a></li><li><a href="module-volume_design.html">volume/design</a></li><li><a href="module-volume_editAccess.html">volume/editAccess</a></li><li><a href="module-volume_editFunding.html">volume/editFunding</a></li><li><a href="module-volume_editLinks.html">volume/editLinks</a></li><li><a href="module-volume_editOverview.html">volume/editOverview</a></li><li><a href="module-volume_excerpts.html">volume/excerpts</a></li><li><a href="module-volume_filter.html">volume/filter</a></li><li><a href="module-volume_fundingGrant.html">volume/fundingGrant</a></li><li><a href="module-volume_fundingSearch.html">volume/fundingSearch</a></li><li><a href="module-volume_list.html">volume/list</a></li><li><a href="module-volume_metadata.html">volume/metadata</a></li><li><a href="module-volume_meter.html">volume/meter</a></li><li><a href="module-volume_meterCanvas.html">volume/meterCanvas</a></li><li><a href="module-volume_overview.html">volume/overview</a></li><li><a href="module-volume_owners.html">volume/owners</a></li><li><a href="module-volume_pivot.html">volume/pivot</a></li><li><a href="module-volume_showInvestigators.html">volume/showInvestigators</a></li><li><a href="module-volume_slot.html">volume/slot</a></li><li><a href="module-volume_spreadsheet.html">volume/spreadsheet</a></li></ul><h3>Services</h3><ul><li><a href="analyticService.html">analyticService</a></li><li><a href="authService.html">authService</a></li><li><a href="constantService.html">constantService</a></li><li><a href="displayService.html">displayService</a></li><li><a href="messageService.html">messageService</a></li></ul><h3>Controllers</h3><ul><li><a href="site_home.html">site/home</a></li><li><a href="volume_activity.html">volume/activity</a></li><li><a href="volume_csv.html">volume/csv</a></li><li><a href="volume_edit.html">volume/edit</a></li><li><a href="volume_search.html">volume/search</a></li><li><a href="volume_slotActivity.html">volume/slotActivity</a></li><li><a href="volume_view.html">volume/view</a></li><li><a href="volume_zip.html">volume/zip</a></li></ul><h3>Functions</h3><ul><li><a href="-_anonymous_-pre-checkDirty.html">checkDirty</a></li><li><a href="-_anonymous_-pre-form.$setUnsubmitted.html">$setUnsubmitted</a></li><li><a href="-_anonymous_-pre-form.resetAll.html">resetAll</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu May 17 2018 12:01:00 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
