<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Store.Service</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Store-Service.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Store-Service.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">databrary-1: Databrary</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Store.Service</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Storage">Storage</a></li><li class="src short"><a href="#v:initStorage">initStorage</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-String.html#t:String">String</a> <a href="Store-Service.html#t:StorageLocationConfig">StorageLocationConfig</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Store-Types.html#t:Transcoder">Transcoder</a>) -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Store-Service.html#t:Storage">Storage</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:StorageLocationConfig">StorageLocationConfig</a> = <a href="#v:StorageLocationConfig">StorageLocationConfig</a> {<ul class="subs"><li><a href="#v:storageLocTemp">storageLocTemp</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></li><li><a href="#v:storageLocMaster">storageLocMaster</a> :: <a href="Files.html#t:RawFilePath">RawFilePath</a></li><li><a href="#v:storageLocUpload">storageLocUpload</a> :: <a href="Files.html#t:RawFilePath">RawFilePath</a></li><li><a href="#v:storageLocCache">storageLocCache</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></li><li><a href="#v:storageLocStage">storageLocStage</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></li><li><a href="#v:storageLocFallback">storageLocFallback</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></li></ul>}</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Storage" class="def">Storage</a> <a href="src/Store-Types.html#Storage" class="link">Source</a> <a href="#t:Storage" class="selflink">#</a></p><div class="subs instances"><p id="control.i:Storage" class="caption collapser" onclick="toggleSection('i:Storage')">Instances</p><div id="section.i:Storage" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Storage:Has:1" class="instance expander" onclick="toggleSection('i:id:Storage:Has:1')"></span> <a href="Has.html#t:Has">Has</a> <a href="Store-Service.html#t:Storage">Storage</a> <a href="Service-Types.html#t:Service">Service</a></span> <a href="src/Has.html#line-71" class="link">Source</a> <a href="#t:Has" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Storage:Has:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:view">view</a> :: <a href="Service-Types.html#t:Service">Service</a> -&gt; <a href="Store-Service.html#t:Storage">Storage</a> <a href="src/Has.html#view" class="link">Source</a> <a href="#v:view" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Storage:Has:2" class="instance expander" onclick="toggleSection('i:id:Storage:Has:2')"></span> <a href="Has.html#t:Has">Has</a> <a href="Store-Service.html#t:Storage">Storage</a> <a href="Context.html#t:BackgroundContext">BackgroundContext</a></span> <a href="src/Has.html#line-106" class="link">Source</a> <a href="#t:Has" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Storage:Has:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:view">view</a> :: <a href="Context.html#t:BackgroundContext">BackgroundContext</a> -&gt; <a href="Store-Service.html#t:Storage">Storage</a> <a href="src/Has.html#view" class="link">Source</a> <a href="#v:view" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Storage:Has:3" class="instance expander" onclick="toggleSection('i:id:Storage:Has:3')"></span> <a href="Has.html#t:Has">Has</a> <a href="Store-Service.html#t:Storage">Storage</a> <a href="Context.html#t:ActionContext">ActionContext</a></span> <a href="src/Has.html#line-66" class="link">Source</a> <a href="#t:Has" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Storage:Has:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:view">view</a> :: <a href="Context.html#t:ActionContext">ActionContext</a> -&gt; <a href="Store-Service.html#t:Storage">Storage</a> <a href="src/Has.html#view" class="link">Source</a> <a href="#v:view" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Storage:Has:4" class="instance expander" onclick="toggleSection('i:id:Storage:Has:4')"></span> <a href="Has.html#t:Has">Has</a> <a href="Store-Service.html#t:Storage">Storage</a> <a href="Action-Types.html#t:RequestContext">RequestContext</a></span> <a href="src/Has.html#line-71" class="link">Source</a> <a href="#t:Has" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Storage:Has:4" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:view">view</a> :: <a href="Action-Types.html#t:RequestContext">RequestContext</a> -&gt; <a href="Store-Service.html#t:Storage">Storage</a> <a href="src/Has.html#view" class="link">Source</a> <a href="#v:view" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:initStorage" class="def">initStorage</a> <a href="src/Store-Service.html#initStorage" class="link">Source</a> <a href="#v:initStorage" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Either.html#t:Either">Either</a> <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-String.html#t:String">String</a> <a href="Store-Service.html#t:StorageLocationConfig">StorageLocationConfig</a></td><td class="doc"><p>Either the set of paths to use for storage, or a message explaining why
 storage isn't available. This Either will collapse very soon, once use
 sites of initStorage are rewritten.</p></td></tr><tr><td class="src">-&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Store-Types.html#t:Transcoder">Transcoder</a>)</td><td class="doc"><p>An action that might produce a transcoder. I kept this is IO to keep
 the implementation identical, without reordering error messages. I highly
 suspect that is overkill, and this will get moved out of IO.</p></td></tr><tr><td class="src">-&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/System-IO.html#t:IO">IO</a> <a href="Store-Service.html#t:Storage">Storage</a></td><td class="doc"><p>The <code><a href="Store-Service.html#t:Storage">Storage</a></code> resource (presuming no exceptions were thrown).</p></td></tr></table></div><div class="doc"><p>Initialize the configured storage location. It checks for the existence of
 certain directories and adds subdirectories. Primarily, this allows us to
 interface with third party services (NYU HPC) that have set up certain
 directories for us to use.</p><p>This may throw a variety of unchecked exceptions, which is probably the right
 thing to do for initialization.</p><p>TODO:
 * Combine initCache and initTemp, which are doing the same thing with quite
   different implementations: appending a subdirectory, and creating it if it
   doesn't exist
 * Commit to reordering execution steps, purifying the second arg
 * Use throwIO instead of error</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:StorageLocationConfig" class="def">StorageLocationConfig</a> <a href="src/Store-Service.html#StorageLocationConfig" class="link">Source</a> <a href="#t:StorageLocationConfig" class="selflink">#</a></p><div class="doc"><p>Locations used by Storage. This is almost <em>identical</em> to <code><a href="Store-Service.html#t:Storage">Storage</a></code>, except
 in how it's used and what it represents. Future work might merge the two
 types.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:StorageLocationConfig" class="def">StorageLocationConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:storageLocTemp" class="def">storageLocTemp</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:storageLocMaster" class="def">storageLocMaster</a> :: <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:storageLocUpload" class="def">storageLocUpload</a> :: <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:storageLocCache" class="def">storageLocCache</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:storageLocStage" class="def">storageLocStage</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:storageLocFallback" class="def">storageLocFallback</a> :: <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Files.html#t:RawFilePath">RawFilePath</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>