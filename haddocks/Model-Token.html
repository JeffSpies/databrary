<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Model.Token</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Model-Token.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Model-Token.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">databrary-1: Databrary</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Model.Token</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short">module <a href="Model-Token-Types.html">Model.Token.Types</a></li><li class="src short"><a href="#v:loginTokenId">loginTokenId</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Types.html#t:Secret">Secret</a> c m, <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m) =&gt; <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m (<a href="Model-Id-Types.html#t:Id">Id</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a>)</li><li class="src short"><a href="#v:lookupLoginToken">lookupLoginToken</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Types.html#t:Secret">Secret</a> c m) =&gt; <a href="Model-Id-Types.html#t:Id">Id</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a>)</li><li class="src short"><a href="#v:createLoginToken">createLoginToken</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m) =&gt; <a href="Model-Party-Types.html#t:SiteAuth">SiteAuth</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; m <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a></li><li class="src short"><a href="#v:removeLoginToken">removeLoginToken</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:lookupSession">lookupSession</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:Session">Session</a>)</li><li class="src short"><a href="#v:createSession">createSession</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m) =&gt; <a href="Model-Party-Types.html#t:SiteAuth">SiteAuth</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; m <a href="Model-Token-Types.html#t:Session">Session</a></li><li class="src short"><a href="#v:removeSession">removeSession</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="Model-Token-Types.html#t:Session">Session</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:lookupUpload">lookupUpload</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Model-Identity-Types.html#t:MonadHasIdentity">MonadHasIdentity</a> c m) =&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:Upload">Upload</a>)</li><li class="src short"><a href="#v:createUpload">createUpload</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Model-Identity-Types.html#t:MonadHasIdentity">MonadHasIdentity</a> c m) =&gt; <a href="Model-Volume-Types.html#t:Volume">Volume</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Int.html#t:Int64">Int64</a> -&gt; m <a href="Model-Token-Types.html#t:Upload">Upload</a></li><li class="src short"><a href="#v:removeUpload">removeUpload</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Store-Types.html#t:MonadStorage">MonadStorage</a> c m) =&gt; <a href="Model-Token-Types.html#t:Upload">Upload</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:cleanTokens">cleanTokens</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Store-Types.html#t:MonadStorage">MonadStorage</a> c m) =&gt; m ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src">module <a href="Model-Token-Types.html">Model.Token.Types</a></p></div><div class="top"><p class="src"><a id="v:loginTokenId" class="def">loginTokenId</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Types.html#t:Secret">Secret</a> c m, <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m) =&gt; <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m (<a href="Model-Id-Types.html#t:Id">Id</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a>) <a href="src/Model-Token.html#loginTokenId" class="link">Source</a> <a href="#v:loginTokenId" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:lookupLoginToken" class="def">lookupLoginToken</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Types.html#t:Secret">Secret</a> c m) =&gt; <a href="Model-Id-Types.html#t:Id">Id</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a>) <a href="src/Model-Token.html#lookupLoginToken" class="link">Source</a> <a href="#v:lookupLoginToken" class="selflink">#</a></p><div class="doc"><p>Attempt to find the matching one time login token for newly registered accounts,
 so that the user can view the password entry form as well as perform the password update.
 Retrieve the site auth with access deduced from inherited authorizations.
 Wrap the site auth in an AccountToken with the corresponding public token value and expiration.
 Wrap the AccountToken in a LoginToken with a boolean indicating ???? . Seems to be always true.</p></div></div><div class="top"><p class="src"><a id="v:createLoginToken" class="def">createLoginToken</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m) =&gt; <a href="Model-Party-Types.html#t:SiteAuth">SiteAuth</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; m <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> <a href="src/Model-Token.html#createLoginToken" class="link">Source</a> <a href="#v:createLoginToken" class="selflink">#</a></p><div class="doc"><p>Delete any prior login token that was generated for this account, then generate a new login token.
 Used when generating the login token for reset password email. paswd will always be True.</p></div></div><div class="top"><p class="src"><a id="v:removeLoginToken" class="def">removeLoginToken</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="Model-Token-Types.html#t:LoginToken">LoginToken</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Model-Token.html#removeLoginToken" class="link">Source</a> <a href="#v:removeLoginToken" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:lookupSession" class="def">lookupSession</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:Session">Session</a>) <a href="src/Model-Token.html#lookupSession" class="link">Source</a> <a href="#v:lookupSession" class="selflink">#</a></p><div class="doc"><p>Guts of loading a user and its authorizations during each request, when receiving a logged in session token.
 Find the active session in the sessions table.
 Join the session account with its party and account information.
 Join the party with the authorization it has been granted on the databrary site (party 0), if any.
 Ultimately, a Session object will be created with an access object built up from the user's
 effective, inherited permissions on the databrary site (party 0).
 Note that whenever lookupSession is called, we will be in a bootstrap phase of request handling, where
 the application hasn't attach an identity (MonadHasIdentity) to the context of actions yet.</p></div></div><div class="top"><p class="src"><a id="v:createSession" class="def">createSession</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m) =&gt; <a href="Model-Party-Types.html#t:SiteAuth">SiteAuth</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; m <a href="Model-Token-Types.html#t:Session">Session</a> <a href="src/Model-Token.html#createSession" class="link">Source</a> <a href="#v:createSession" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:removeSession" class="def">removeSession</a> :: <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m =&gt; <a href="Model-Token-Types.html#t:Session">Session</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Model-Token.html#removeSession" class="link">Source</a> <a href="#v:removeSession" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:lookupUpload" class="def">lookupUpload</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Model-Identity-Types.html#t:MonadHasIdentity">MonadHasIdentity</a> c m) =&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; m (<a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Model-Token-Types.html#t:Upload">Upload</a>) <a href="src/Model-Token.html#lookupUpload" class="link">Source</a> <a href="#v:lookupUpload" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:createUpload" class="def">createUpload</a> :: (<a href="Has.html#t:MonadHas">MonadHas</a> <a href="Service-Entropy.html#t:Entropy">Entropy</a> c m, <a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Model-Identity-Types.html#t:MonadHasIdentity">MonadHasIdentity</a> c m) =&gt; <a href="Model-Volume-Types.html#t:Volume">Volume</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.8.1/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Int.html#t:Int64">Int64</a> -&gt; m <a href="Model-Token-Types.html#t:Upload">Upload</a> <a href="src/Model-Token.html#createUpload" class="link">Source</a> <a href="#v:createUpload" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:removeUpload" class="def">removeUpload</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Store-Types.html#t:MonadStorage">MonadStorage</a> c m) =&gt; <a href="Model-Token-Types.html#t:Upload">Upload</a> -&gt; m <a href="file:///nix/store/yl5m2cp3zsx9zgndv7f2q06b5w6n9vh2-ghc-8.0.2-doc/share/doc/ghc/html/libraries/base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Model-Token.html#removeUpload" class="link">Source</a> <a href="#v:removeUpload" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:cleanTokens" class="def">cleanTokens</a> :: (<a href="Service-DB.html#t:MonadDB">MonadDB</a> c m, <a href="Store-Types.html#t:MonadStorage">MonadStorage</a> c m) =&gt; m () <a href="src/Model-Token.html#cleanTokens" class="link">Source</a> <a href="#v:cleanTokens" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>