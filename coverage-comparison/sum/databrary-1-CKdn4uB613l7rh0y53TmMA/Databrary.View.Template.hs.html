<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
</head>
<body>
<pre>
<span class="lineno">    1 </span>{-# LANGUAGE OverloadedStrings #-}
<span class="lineno">    2 </span>module Databrary.View.Template
<span class="lineno">    3 </span>  ( htmlHeader
<span class="lineno">    4 </span>  , htmlFooter
<span class="lineno">    5 </span>  , htmlTemplate
<span class="lineno">    6 </span>  , htmlSocialMedia
<span class="lineno">    7 </span>  ) where
<span class="lineno">    8 </span>
<span class="lineno">    9 </span>import Control.Monad (void, when, forM_)
<span class="lineno">   10 </span>import qualified Data.ByteString.Builder as BSB
<span class="lineno">   11 </span>import Data.Monoid ((&lt;&gt;))
<span class="lineno">   12 </span>import qualified Data.Text as T
<span class="lineno">   13 </span>import Data.Version (showVersion)
<span class="lineno">   14 </span>import qualified Text.Blaze.Html5 as H
<span class="lineno">   15 </span>import qualified Text.Blaze.Html5.Attributes as HA
<span class="lineno">   16 </span>import Network.HTTP.Types (methodGet)
<span class="lineno">   17 </span>import qualified Network.Wai as Wai
<span class="lineno">   18 </span>
<span class="lineno">   19 </span>import Paths_databrary (version)
<span class="lineno">   20 </span>import Databrary.Ops
<span class="lineno">   21 </span>import Databrary.Has (view)
<span class="lineno">   22 </span>import Databrary.Model.Identity
<span class="lineno">   23 </span>import Databrary.Action.Types
<span class="lineno">   24 </span>import Databrary.Action.Route
<span class="lineno">   25 </span>import Databrary.Controller.Paths
<span class="lineno">   26 </span>import Databrary.View.Html
<span class="lineno">   27 </span>
<span class="lineno">   28 </span>import {-# SOURCE #-} Databrary.Controller.Angular
<span class="lineno">   29 </span>import {-# SOURCE #-} Databrary.Controller.Root
<span class="lineno">   30 </span>import {-# SOURCE #-} Databrary.Controller.Login
<span class="lineno">   31 </span>import {-# SOURCE #-} Databrary.Controller.Party
<span class="lineno">   32 </span>import {-# SOURCE #-} Databrary.Controller.Web
<span class="lineno">   33 </span>
<span class="lineno">   34 </span>htmlHeader :: Maybe BSB.Builder -&gt; JSOpt -&gt; H.Html
<span class="lineno">   35 </span><span class="decl"><span class="istickedoff">htmlHeader canon hasjs = do</span>
<span class="lineno">   36 </span><span class="spaces">  </span><span class="istickedoff">forM_ canon $ <span class="nottickedoff">\c -&gt;</span></span>
<span class="lineno">   37 </span><span class="spaces">    </span><span class="istickedoff"><span class="nottickedoff">H.link</span></span>
<span class="lineno">   38 </span><span class="spaces">      </span><span class="istickedoff"><span class="nottickedoff">H.! HA.rel &quot;canonical&quot;</span></span>
<span class="lineno">   39 </span><span class="spaces">      </span><span class="istickedoff"><span class="nottickedoff">H.! HA.href (builderValue c)</span></span>
<span class="lineno">   40 </span><span class="spaces">  </span><span class="istickedoff">H.link</span>
<span class="lineno">   41 </span><span class="spaces">    </span><span class="istickedoff">H.! HA.rel &quot;shortcut icon&quot;</span>
<span class="lineno">   42 </span><span class="spaces">    </span><span class="istickedoff">H.! HA.href (builderValue $ actionURL Nothing webFile (Just $ staticPath [&quot;icons&quot;, &quot;favicon.png&quot;]) [])</span>
<span class="lineno">   43 </span><span class="spaces">  </span><span class="istickedoff">H.link</span>
<span class="lineno">   44 </span><span class="spaces">    </span><span class="istickedoff">H.! HA.rel &quot;start&quot;</span>
<span class="lineno">   45 </span><span class="spaces">    </span><span class="istickedoff">H.! actionLink viewRoot HTML hasjs</span>
<span class="lineno">   46 </span><span class="spaces">  </span><span class="istickedoff">forM_ [&quot;news&quot;, &quot;about&quot;, &quot;access&quot;, &quot;community&quot;] $ \l -&gt; H.link</span>
<span class="lineno">   47 </span><span class="spaces">    </span><span class="istickedoff">H.! HA.rel l</span>
<span class="lineno">   48 </span><span class="spaces">    </span><span class="istickedoff">H.! HA.href (&quot;//databrary.org/&quot; &lt;&gt; l &lt;&gt; &quot;.html&quot;)</span></span>
<span class="lineno">   49 </span>
<span class="lineno">   50 </span>htmlAddress :: H.Html
<span class="lineno">   51 </span><span class="decl"><span class="istickedoff">htmlAddress =</span>
<span class="lineno">   52 </span><span class="spaces">  </span><span class="istickedoff">H.p H.! HA.class_ &quot;footer-address&quot; $ do</span>
<span class="lineno">   53 </span><span class="spaces">    </span><span class="istickedoff">H.strong $ do</span>
<span class="lineno">   54 </span><span class="spaces">      </span><span class="istickedoff">void &quot;Databrary&quot;</span>
<span class="lineno">   55 </span><span class="spaces">    </span><span class="istickedoff">H.br</span>
<span class="lineno">   56 </span><span class="spaces">    </span><span class="istickedoff">void &quot;196 Mercer Street, Room 807 | New York, NY 10012&quot;</span>
<span class="lineno">   57 </span><span class="spaces">    </span><span class="istickedoff">H.br</span>
<span class="lineno">   58 </span><span class="spaces">    </span><span class="istickedoff">void &quot;212.998.5800&quot;</span></span>
<span class="lineno">   59 </span>    
<span class="lineno">   60 </span>htmlSocialMedia :: H.Html
<span class="lineno">   61 </span><span class="decl"><span class="istickedoff">htmlSocialMedia =</span>
<span class="lineno">   62 </span><span class="spaces">  </span><span class="istickedoff">H.p H.! HA.class_ &quot;footer-social-media&quot; $ do</span>
<span class="lineno">   63 </span><span class="spaces">    </span><span class="istickedoff">let sm n l a =</span>
<span class="lineno">   64 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href l H.! HA.target &quot;_blank&quot; H.! HA.class_ &quot;img&quot; $</span>
<span class="lineno">   65 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.id n H.! HA.src (&quot;/web/images/social/16px/&quot; &lt;&gt; n &lt;&gt; &quot;.png&quot;) H.! HA.alt a</span>
<span class="lineno">   66 </span><span class="spaces">    </span><span class="istickedoff">void &quot;Find us on &quot;</span>
<span class="lineno">   67 </span><span class="spaces">    </span><span class="istickedoff">sm &quot;twitter&quot; &quot;https://twitter.com/databrary&quot; &quot;Twitter&quot;</span>
<span class="lineno">   68 </span><span class="spaces">    </span><span class="istickedoff">void &quot; &quot;</span>
<span class="lineno">   69 </span><span class="spaces">    </span><span class="istickedoff">sm &quot;facebook&quot; &quot;https://www.facebook.com/databrary&quot; &quot;Facebook&quot;</span>
<span class="lineno">   70 </span><span class="spaces">    </span><span class="istickedoff">void &quot; &quot;</span>
<span class="lineno">   71 </span><span class="spaces">    </span><span class="istickedoff">sm &quot;linkedin&quot; &quot;https://www.linkedin.com/company/databrary-project&quot; &quot;LinkedIn&quot;</span>
<span class="lineno">   72 </span><span class="spaces">    </span><span class="istickedoff">void &quot; &quot;</span>
<span class="lineno">   73 </span><span class="spaces">    </span><span class="istickedoff">sm &quot;google-plus&quot; &quot;https://plus.google.com/u/1/111083162045777800330/posts&quot; &quot;Google+&quot;</span>
<span class="lineno">   74 </span><span class="spaces">    </span><span class="istickedoff">void &quot; &quot;</span>
<span class="lineno">   75 </span><span class="spaces">    </span><span class="istickedoff">sm &quot;github&quot; &quot;https://github.com/databrary/&quot; &quot;GitHub&quot;</span></span>
<span class="lineno">   76 </span>
<span class="lineno">   77 </span>htmlFooter :: H.Html
<span class="lineno">   78 </span><span class="decl"><span class="istickedoff">htmlFooter = H.footer H.! HA.id &quot;site-footer&quot; H.! HA.class_ &quot;site-footer&quot; $</span>
<span class="lineno">   79 </span><span class="spaces">  </span><span class="istickedoff">H.div H.! HA.class_ &quot;wrap&quot; $</span>
<span class="lineno">   80 </span><span class="spaces">    </span><span class="istickedoff">H.div H.! HA.class_ &quot;row&quot; $ do</span>
<span class="lineno">   81 </span><span class="spaces">      </span><span class="istickedoff">H.div H.! HA.class_ &quot;site-footer-social-address&quot; $ do</span>
<span class="lineno">   82 </span><span class="spaces">        </span><span class="istickedoff">htmlAddress</span>
<span class="lineno">   83 </span><span class="spaces">        </span><span class="istickedoff">htmlSocialMedia</span>
<span class="lineno">   84 </span><span class="spaces">      </span><span class="istickedoff">H.ul H.! HA.class_ &quot;site-footer-grants&quot; $ do</span>
<span class="lineno">   85 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">   86 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;http://www.nyu.edu&quot; $ do</span>
<span class="lineno">   87 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/nyu-small.jpg&quot; H.! HA.class_ &quot;nyu&quot;</span>
<span class="lineno">   88 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">   89 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;http://www.psu.edu&quot; $ do</span>
<span class="lineno">   90 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/pennstate.png&quot; H.! HA.class_ &quot;psu&quot;</span>
<span class="lineno">   91 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">   92 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;http://www.nsf.gov/awardsearch/showAward?AWD_ID=1238599&amp;HistoricalAwards=false&quot; $ do</span>
<span class="lineno">   93 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/nsf.png&quot; H.! HA.class_ &quot;nsf&quot;</span>
<span class="lineno">   94 </span><span class="spaces">            </span><span class="istickedoff">&quot; BCS-1238599&quot;</span>
<span class="lineno">   95 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">   96 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;http://projectreporter.nih.gov/project_info_description.cfm?aid=8531595&amp;icde=15908155&amp;ddparam=&amp;ddvalue=&amp;ddsub=&amp;cr=1&amp;csb=default&amp;cs=ASC&quot; $ do</span>
<span class="lineno">   97 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/nih.png&quot; H.! HA.class_ &quot;nih&quot;</span>
<span class="lineno">   98 </span><span class="spaces">            </span><span class="istickedoff">&quot; U01-HD-076595&quot;</span>
<span class="lineno">   99 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">  100 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;https://www.srcd.org/&quot; $ do</span>
<span class="lineno">  101 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/srcd.png&quot; H.! HA.class_ &quot;srcd&quot;</span>
<span class="lineno">  102 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">  103 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;https://sloan.org/&quot; $ do</span>
<span class="lineno">  104 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/sloan.png&quot; H.! HA.class_ &quot;sloan&quot;</span>
<span class="lineno">  105 </span><span class="spaces">        </span><span class="istickedoff">H.li $</span>
<span class="lineno">  106 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;http://www.legofoundation.com&quot; $ do</span>
<span class="lineno">  107 </span><span class="spaces">            </span><span class="istickedoff">H.img H.! HA.src &quot;/web/images/grants/lego.png&quot; H.! HA.class_ &quot;lego&quot;</span>
<span class="lineno">  108 </span><span class="spaces">      </span><span class="istickedoff">H.div H.! HA.class_ &quot;site-footer-legal col&quot; $ do</span>
<span class="lineno">  109 </span><span class="spaces">        </span><span class="istickedoff">H.p $ do</span>
<span class="lineno">  110 </span><span class="spaces">          </span><span class="istickedoff">void &quot;Each dataset on Databrary represents an individual work owned by the party who contributed it. Data on Databrary are provided for non-commercial use and are subject to the terms of use outlined in the &quot;</span>
<span class="lineno">  111 </span><span class="spaces">          </span><span class="istickedoff">H.a H.! HA.href &quot;//databrary.org/access/policies/agreement.html&quot; H.! HA.target &quot;_blank&quot; $</span>
<span class="lineno">  112 </span><span class="spaces">            </span><span class="istickedoff">&quot;Databrary Access Agreement&quot;</span>
<span class="lineno">  113 </span><span class="spaces">          </span><span class="istickedoff">void &quot;. [&quot;</span>
<span class="lineno">  114 </span><span class="spaces">          </span><span class="istickedoff">H.string $ showVersion version</span>
<span class="lineno">  115 </span><span class="spaces">          </span><span class="istickedoff">&quot;]&quot;</span></span>
<span class="lineno">  116 </span>
<span class="lineno">  117 </span>htmlTemplate :: RequestContext -&gt; Maybe T.Text -&gt; (JSOpt -&gt; H.Html) -&gt; H.Html
<span class="lineno">  118 </span><span class="decl"><span class="istickedoff">htmlTemplate req title body = H.docTypeHtml $ do</span>
<span class="lineno">  119 </span><span class="spaces">  </span><span class="istickedoff">H.head $ do</span>
<span class="lineno">  120 </span><span class="spaces">    </span><span class="istickedoff">htmlHeader canon hasjs</span>
<span class="lineno">  121 </span><span class="spaces">    </span><span class="istickedoff">H.link</span>
<span class="lineno">  122 </span><span class="spaces">      </span><span class="istickedoff">H.! HA.rel &quot;stylesheet&quot;</span>
<span class="lineno">  123 </span><span class="spaces">      </span><span class="istickedoff">H.! actionLink webFile (Just $ StaticPath &quot;all.min.css&quot;) ([] :: Query)</span>
<span class="lineno">  124 </span><span class="spaces">    </span><span class="istickedoff">H.title $ do</span>
<span class="lineno">  125 </span><span class="spaces">      </span><span class="istickedoff">mapM_ (\t -&gt; H.toHtml t &gt;&gt; &quot; || &quot;) title</span>
<span class="lineno">  126 </span><span class="spaces">      </span><span class="istickedoff">&quot;Databrary&quot;</span>
<span class="lineno">  127 </span><span class="spaces">  </span><span class="istickedoff">H.body H.! H.customAttribute &quot;vocab&quot; &quot;http://schema.org&quot; $ do</span>
<span class="lineno">  128 </span><span class="spaces">    </span><span class="istickedoff">H.section</span>
<span class="lineno">  129 </span><span class="spaces">      </span><span class="istickedoff">H.! HA.id &quot;toolbar&quot;</span>
<span class="lineno">  130 </span><span class="spaces">      </span><span class="istickedoff">H.! HA.class_ &quot;toolbar&quot;</span>
<span class="lineno">  131 </span><span class="spaces">      </span><span class="istickedoff">$ H.div</span>
<span class="lineno">  132 </span><span class="spaces">        </span><span class="istickedoff">H.! HA.class_ &quot;wrap toolbar-main&quot;</span>
<span class="lineno">  133 </span><span class="spaces">        </span><span class="istickedoff">$ H.div</span>
<span class="lineno">  134 </span><span class="spaces">          </span><span class="istickedoff">H.! HA.class_ &quot;row&quot;</span>
<span class="lineno">  135 </span><span class="spaces">          </span><span class="istickedoff">$ H.nav</span>
<span class="lineno">  136 </span><span class="spaces">            </span><span class="istickedoff">H.! HA.class_ &quot;toolbar-nav no-angular cf&quot;</span>
<span class="lineno">  137 </span><span class="spaces">            </span><span class="istickedoff">$ do</span>
<span class="lineno">  138 </span><span class="spaces">              </span><span class="istickedoff">H.ul</span>
<span class="lineno">  139 </span><span class="spaces">                </span><span class="istickedoff">H.! HA.class_ &quot;inline-block flat cf&quot;</span>
<span class="lineno">  140 </span><span class="spaces">                </span><span class="istickedoff">$ do</span>
<span class="lineno">  141 </span><span class="spaces">                  </span><span class="istickedoff">H.li $ H.a</span>
<span class="lineno">  142 </span><span class="spaces">                    </span><span class="istickedoff">H.! actionLink viewRoot HTML hasjs</span>
<span class="lineno">  143 </span><span class="spaces">                    </span><span class="istickedoff">$ &quot;Databrary&quot;</span>
<span class="lineno">  144 </span><span class="spaces">                  </span><span class="istickedoff">forM_ [&quot;news&quot;, &quot;about&quot;, &quot;access&quot;, &quot;community&quot;] $ \l -&gt;</span>
<span class="lineno">  145 </span><span class="spaces">                    </span><span class="istickedoff">H.li $ H.a H.! HA.href (H.stringValue $ &quot;//databrary.org/&quot; ++ l ++ &quot;.html&quot;) $ do</span>
<span class="lineno">  146 </span><span class="spaces">                      </span><span class="istickedoff">H.string l</span>
<span class="lineno">  147 </span><span class="spaces">              </span><span class="istickedoff">H.ul</span>
<span class="lineno">  148 </span><span class="spaces">                </span><span class="istickedoff">H.! HA.class_ &quot;toolbar-user inline-block flat cf&quot;</span>
<span class="lineno">  149 </span><span class="spaces">                </span><span class="istickedoff">$ extractFromIdentifiedSessOrDefault</span>
<span class="lineno">  150 </span><span class="spaces">                  </span><span class="istickedoff">(H.li $ H.a H.! actionLink viewLogin () hasjs $ &quot;Login&quot;)</span>
<span class="lineno">  151 </span><span class="spaces">                  </span><span class="istickedoff">(\_ -&gt; do</span>
<span class="lineno">  152 </span><span class="spaces">                    </span><span class="istickedoff">H.li $ H.a H.! actionLink viewParty (HTML, TargetProfile) hasjs $ &quot;Your Dashboard&quot;</span>
<span class="lineno">  153 </span><span class="spaces">                    </span><span class="istickedoff">H.li $ actionForm postLogout HTML hasjs $</span>
<span class="lineno">  154 </span><span class="spaces">                      </span><span class="istickedoff">H.button</span>
<span class="lineno">  155 </span><span class="spaces">                        </span><span class="istickedoff">H.! HA.class_ &quot;mini&quot;</span>
<span class="lineno">  156 </span><span class="spaces">                        </span><span class="istickedoff">H.! HA.type_ &quot;submit&quot;</span>
<span class="lineno">  157 </span><span class="spaces">                        </span><span class="istickedoff">$ &quot;Logout&quot;)</span>
<span class="lineno">  158 </span><span class="spaces">                  </span><span class="istickedoff">$ requestIdentity req</span>
<span class="lineno">  159 </span><span class="spaces">    </span><span class="istickedoff">H.section</span>
<span class="lineno">  160 </span><span class="spaces">      </span><span class="istickedoff">H.! HA.id &quot;main&quot;</span>
<span class="lineno">  161 </span><span class="spaces">      </span><span class="istickedoff">H.! HA.class_ &quot;main&quot;</span>
<span class="lineno">  162 </span><span class="spaces">        </span><span class="istickedoff">$ H.div</span>
<span class="lineno">  163 </span><span class="spaces">          </span><span class="istickedoff">H.! HA.class_ &quot;wrap&quot;</span>
<span class="lineno">  164 </span><span class="spaces">          </span><span class="istickedoff">$ H.div</span>
<span class="lineno">  165 </span><span class="spaces">            </span><span class="istickedoff">H.! HA.class_ &quot;row&quot;</span>
<span class="lineno">  166 </span><span class="spaces">            </span><span class="istickedoff">$ do</span>
<span class="lineno">  167 </span><span class="spaces">              </span><span class="istickedoff">when (hasjs /= JSEnabled) $ forM_ canon $ <span class="nottickedoff">\c -&gt; H.div $ do</span></span>
<span class="lineno">  168 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">H.preEscapedString &quot;Our site works best with modern browsers (Firefox, Chrome, Safari &amp;ge;6, IE &amp;ge;10, and others). \</span></span>
<span class="lineno">  169 </span><span class="spaces">                  </span><span class="istickedoff"><span class="nottickedoff">\You are viewing the simple version of our site: some functionality may not be available. \</span></span>
<span class="lineno">  170 </span><span class="spaces">                  </span><span class="istickedoff"><span class="nottickedoff">\Try switching to the &quot;</span></span>
<span class="lineno">  171 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">H.a H.! HA.href (builderValue c) $ &quot;modern version&quot;</span></span>
<span class="lineno">  172 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">&quot; to see if it will work on your browser.&quot;</span></span>
<span class="lineno">  173 </span><span class="spaces">              </span><span class="istickedoff">mapM_ (H.h1 . H.toHtml) title</span>
<span class="lineno">  174 </span><span class="spaces">                </span><span class="istickedoff">H.! HA.class_ &quot;view-title&quot;</span>
<span class="lineno">  175 </span><span class="spaces">              </span><span class="istickedoff">r &lt;- body <span class="nottickedoff">hasjs</span></span>
<span class="lineno">  176 </span><span class="spaces">              </span><span class="istickedoff">htmlFooter</span>
<span class="lineno">  177 </span><span class="spaces">              </span><span class="istickedoff">return <span class="nottickedoff">r</span></span>
<span class="lineno">  178 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno">  179 </span><span class="spaces">  </span><span class="istickedoff">-- FIXME: I don't think these lines do what they think they do.</span>
<span class="lineno">  180 </span><span class="spaces">  </span><span class="istickedoff">(hasjs, nojs) = jsURL <span class="nottickedoff">JSDefault</span> (view req)</span>
<span class="lineno">  181 </span><span class="spaces">  </span><span class="istickedoff">canon = (Wai.requestMethod (view req) == methodGet &amp;&amp; hasjs == JSDefault) `unlessUse` <span class="nottickedoff">nojs</span></span></span>

</pre>
</body>
</html>
