@(record : models.Record, meas : Seq[Metric[_]], form : controllers.Record.EditForm, json : Html)(implicit request : RequestObject[SiteObject]#Site[_])

@import helper.FieldConstructor

    @implicitField = @{
        FieldConstructor(widget.tag.labeledFieldConstructor.f)
    }

@widget.template.crud("Edit Record: " + record.pageName) {
    @widget.panel.form(record.pageName, "Edit Record") {
        <div class="col-full">
            @widget.formErrors(form)

            @widget.tag.form(routes.Record.update(record.volumeId, record.id)) {
                <h2>@record.category.map(_.name.capitalize) Record</h2>
                @widget.tag.inputHidden(form("category"), 'placeholder -> record.category.get.name)

                <fieldset class="metrics">
                    <legend>Metrics</legend>

                    <div class="repeater repeater-metrics" data-rows="@json.toString">
                        @meas.zipWithIndex.map { case (m, i) =>
                        <div class="repeat">
                            <div class="repeated">
                                @defining(form("measure[" + i + "]")) { form =>
                                    @widget.tag.inputHidden(form("metric"), 'class -> "metric")

                                <label>@m.name (@m.classification)</label>
                                    @m.dataType match {
                                        case DataType.date => {
                                            @widget.tag.inputDate(form("datum"), 'placeholder -> "Date", 'class -> "half datum")
                                        }
                                        case _ if m.values.nonEmpty => {
                                            @widget.tag.select(form("datum"), ("", "") +: m.values.map(v => (v, v)), 'class -> "datum")
                                        }
                                        case _ => {
                                            @widget.tag.inputText(form("datum"), 'class -> "datum")
                                        }
                                    }
                                }
                            </div>
                        </div>
                        }

                        <div class="repeat">
                            <div class="repeated">
                                @widget.tag.select(form("measure["+meas.length+"].metric"), Metric.getAll.map(m => (m.id.toString, m.name + " (" + m.classification + ")")), 'placeholder -> "Metric", 'class -> "metric", '_class -> "metric-div")
                                @widget.tag.inputText(form("measure["+meas.length+"].datum"), 'placeholder -> "Value", 'class -> "datum", '_class -> "datum-div")
                            </div>
                        </div>
                    </div>
                </fieldset>

                <button type='submit' class="button">Update</button>
            }
        </div>
    }
}
