@()(implicit request: VolumeHtml.Request[_])

@defining(request.obj) { volume =>
@defining(Async.wait(volume.top)) { topslot =>
@defining(Async.wait(volume.toplevelAssets)) { toplevel =>
@defining(toplevel groupBy { sa =>
	if(!sa.checkPermission(Permission.DOWNLOAD)) 'o' else sa.format.mimeSubTypes._1 match {
	    case "image" => 'i'
	    case "video" => 'v'
	    case "audio" => 'a'
	    case _ => 'o'
        }
    }) { assets =>

    @widget.template.crud("Volume: " + volume.name) {
        @widget.panel.volume(volume)
        @widget.panel.browser(volume)
        @widget.panel.materials(toplevel)
        @widget.panel.publications(Async.wait(volume.citations))
        @widget.panel.people(volume)
        @widget.panel.tags(topslot, Some(volume))
        @widget.panel.comments(Some(topslot), Some((routes.SlotHtml.comment(topslot.id), SlotHtml.commentForm)), Async.wait(volume.comments))
    }

}
}
}
}
