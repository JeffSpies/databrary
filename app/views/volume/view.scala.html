@()(implicit request: RequestObject[Volume]#Site[_])

	@script = {
		dbjs.tabs('.tabset', '.tab', '.view');
	}

@defining(request.obj) { volume =>
@defining(Async.get(volume.toplevelAssets) groupBy { sa =>
	if (!sa.checkPermission(Permission.DOWNLOAD)) 'o' else sa.format.mimeSubTypes._1 match {
		case "image" => 'i'
		case "video" => 'v'
		case "audio" => 'a'
		case _ => 'o'
	}
}) { assets =>

@template.crud("Volume: " + volume.name, js = script) {
	<div class="row">
		<div class="description col-desktop-6 push-desktop-2 col-laptop-6 col-tablet-6 col-mobile-6">
            @widget.volumeSummary(volume)
		    @volume.body.map(display.plainText _)
		</div>

		<footer class="extended col-desktop-6 col-laptop-6 col-tablet-3 col-mobile-6">
			<div>
				<aside class="thumb">
				@widget.volumeThumb(volume)
				</aside>

				<aside class="dates foot">
					<span class="date created">
						Created <time datetime="@volume.creation" pubdate>@display.dateFmtYM.print(volume.creation)</time></span>
				</aside>

				<aside class="citing foot">
					<h2>Citation</h2>

					@widget.volumeCitation(volume)
				</aside>
			</div>

			<div>
				<div class="row">
					<aside class="investigators foot col-3">
						<h2>Investigators</h2>

						@Async.get(volume.partyAccess).takeWhile(_.access >= Permission.ADMIN).map { a =>
							@widget.userinfo(a.party)
						}
					</aside>

					<div class="col-3">
					@defining(Async.get(volume.funding)) { funding =>
					@if(funding.nonEmpty) {
						<aside class="funding foot">
							<h2>Funding</h2>

							@funding.map { f =>
								@widget.userinfo(f.funder, grant = f.grant)
							}
						</aside>
					}
					}

						<aside class="access cf foot">
							<h2>Sharing</h2>
							@widget.volumeAccess(volume)
						</aside>
					</div>
				</div>
			</div>
		</footer>
	</div>

	<section id="metadata" class="tabset">
        @widget.tabs.sessionTab(volume)
        @widget.tabs.dataTab(volume, assets)
        @widget.tabs.recordTabs(volume)
        @widget.tabs.publicationsTab(volume)
        @widget.tabs.accessTab(volume)
	</section>

	<div class="row">
	@defining(Async.get(volume.topSlot)) { topSlot =>
	@region.comments(Some(topSlot), Some((routes.Slot.comment(volume.id, topSlot.id), controllers.Slot.commentForm)), Async.get(volume.comments))
	@region.tags(topSlot, Some(volume))
	}
	</div>
}

}
}
