@(form : SlotController.SlotForm, records : Seq[Record], recordForm : Option[RecordHtml.SelectForm], selectList : Seq[Record] = Nil)(implicit request : RequestObject[SiteObject]#Site[_])

@implicitField = @{
    helper.FieldConstructor(widget.tag.labeledFieldConstructor.f)
}

@template.form(Some(request.obj), form.formName) {
            @widget.tag.form(form._action) {
		@cast[SlotController.ContainerForm](form).map { form =>
                    @widget.tag.inputText(form.name(), 'placeholder -> "Name")
                    @widget.tag.inputDate(form.date(), 'placeholder -> "Date", 'class -> "half")
                }

                @widget.enumSelect(form.consent(), Consent)

		@widget.formErrors(form())
		<button type='submit' class="button">@form.actionName</button>
            }

            @request.obj match {
                case slot : Slot => {
                    <fieldset>
                        <legend>Records</legend>

                        <table class="records">
                            <thead>
                                <tr>
                                    <th class="main">Record</th>
                                    <th class="meta">Category</th>
				    @recordForm.map { _ =>
				    <th class="meta">Action</th>
				    }
                                </tr>
                            </thead>

                            <tbody>
                                @if(records.nonEmpty) {
                                    @records.map { record =>
                                        <tr>
                                            <td class="main">
                                                @display(record)
                                            </td>

                                            <td class="meta">
                                                @record.category.fold("")(_.name)
                                            </td>

                                            <td class="meta">
                                                <a href="@routes.RecordHtml.edit(record.id)" class="button">edit</a>

                                            @widget.tag.form(routes.RecordHtml.remove(record.id, slot.containerId, slot.segment, true)) {
                                                <button type='submit' class="button first">remove</button>
                                            }
                                            </td>
                                        </tr>
                                    }
                                } else {
                                    <tr>
                                        <td class="empty" colspan="@if(recordForm.nonEmpty) {3} else {2}">There are no records assigned.</td>
                                    </tr>
                                }
                            </tbody>

                            @recordForm.map { form =>
                                <tfoot>
                                    <tr>
                                    @widget.tag.form(form._action) {
				    @defining(helper.FieldConstructor(widget.tag.tableFieldConstructor.f)) { implicit implicitField =>

					@widget.tag.select(form.record(), selectList.map(r => (r.id.toString, r.category.fold("")(_.name + ':') + r.ident)), ('_default, "Create new record..."), ('_colspan, 2))

                                        <td>
					    @widget.formErrors(form())
                                            <button type='submit' class="button third">add record</button>
                                        </td>
                                    }
				    }
                                    </tr>
                                </tfoot>
                            }
                        </table>
                    </fieldset>
                }

                case _ => {

                }
            }
}
