<ng-form name="volumeEditMaterialsForm" bindonce flow-init="flowOptions"
    flow-file-added="volumeEditMaterialsForm.fileAdded($file, $event)"
    flow-file-success="volumeEditMaterialsForm.fileSuccess($file)"
    flow-file-progress="volumeEditMaterialsForm.fileProgress($file)">
  <section class="vem-float" flow-drag-enter="dropClasses['over-form'] = true" flow-drag-leave="dropClasses['over-form'] = false" ng-init="dropClasses={'drop-zone': true}">
    <div class="vem-float-floater">
      <div class="vem-float-dropzone " flow-drop flow-btn flow-drag-enter="dropClasses['over-zone'] = true" flow-drag-leave="dropClasses['over-zone'] = false" ng-class="dropClasses">
        <span class="icon line add"></span>
        <span class="vem-float-dropzone-message" bo-text="'asset.add-drop' | message"></span>
      </div>

      <button class="green" ng-click="volumeEditMaterialsForm.saveAll()" bo-text="'save' | message" ng-disabled="volumeEditMaterialsForm.$pristine"></button>
      <button class="yellow" ng-click="volumeEditMaterialsForm.resetAll()" bo-text="'revert' | message" ng-disabled="volumeEditMaterialsForm.$pristine"></button>
    </div>
  </section>

  <fieldset ng-repeat="material in volumeEditMaterialsForm.materials"
      ng-form="material.form"
      flow-drag-enter="dropClasses['over-form'] = true"
      flow-drag-leave="dropClasses['over-form'] = false"
      ng-init="dropClasses={'drop-zone': true}"
      style="position: relative;" class="vem-repeat">

    <div class="vem-repeat-content">

      <validator name="file" label="'asset.file' | message">
        <div ng-if="material.file">
          <span ng-bind="material.file.name"></span>
          <upload-progress progress-value="material.progress"></upload-progress>
        </div>

        <div ng-if="material.replace" class="vem-file-dropzone" ng-class="dropClasses" flow-drag-enter="dropClasses['over-zone'] = true" flow-drag-leave="dropClasses['over-zone'] = false" flow-drop flow-btn>
          <!--DO NOT USE ng-bind or bo-text: problem with flow-btn/assignBrowse's child input-->
          {{'asset.add-drop.replace' | message}}
        </div>

        <input ng-if="material.asset && !material.replace" type="text" name="filename" ng-value="material.asset.asset.creation.name + ' ' + page.$filter('date')(material.asset.asset.creation.date, 'medium')" disabled outside="volumeEditMaterialsForm">
        <div class="file-button-set">
          <button ng-if="material.asset && !material.replace" ng-click="volumeEditMaterialsForm.replace(material)" bo-text="'replace' | message" class="blue mini"></button>        
          <button class="red mini" ng-disabled="material.pending" ng-click="volumeEditMaterialsForm.remove(material)" class="col-desktop-1 col-tablet-1 col-mobile-1"><span class="icon line vem-trash trash"></span></button>
        </div>

      </validator>

      <validator name="classification" label="'asset.classification' | message">
        <classification-select name="classification" ng-model="material.data.classification"></classification-select>
      </validator>

      <input type="checkbox" name="excerptOn" ng-model="material.data.excerptOn">
      <span bo-text="'asset.excerpt.checkbox-label' | message"></span>
      <validator class="excerpt-validator" name="excerpt" ng-show="material.data.excerptOn" label="'asset.excerpt' | message">
        <select name="excerpt" ng-model="material.data.excerpt" ng-options="i as 'classification.excerpt.'+c | message for (i, c) in volumeEditMaterialsForm.excerptOptions(material)" ng-disabled="material.data.classification >= page.classification.PUBLIC"></select>
      </validator>

      <validator name="name" label="'asset.name' | message">
        <input type="text" name="name" ng-model="material.data.name" placeholder="{{'asset.name.placeholder' | message}}">
      </validator>
    </div>
  </fieldset>
</ng-form>
