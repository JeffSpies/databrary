<panel ng-controller="NetworkPanel" id="panel_network" title="Network" fold>
    <panel-mode name="view" active>
        <div ng-show="parents">
            <h2>Authorized by</h2>

            <div class="row">
                <div ng-repeat="party in parents" class="col-desktop-3 col-laptop-3 col-tablet-3 col-mobile-3">
                    <portrait class="portrait_avatar" hover></portrait>
                </div>
            </div>
        </div>

        <div ng-show="children">
            <h2>People I've Authorized</h2>

            <div class="row">
                <div ng-repeat="party in children" class="col-desktop-3 col-laptop-3 col-tablet-3 col-mobile-3">
                    <portrait class="portrait_avatar" hover></portrait>
                </div>
            </div>
        </div>
    </panel-mode>
<!--
    <panel-mode name="apply">
        <div ng-show="parents">
            <h2>Authorized by</h2>

            <div class="row">
                <div ng-repeat="party in parents" class="col-desktop-3 col-laptop-3 col-tablet-3 col-mobile-3">
                    <portrait class="portrait_avatar" hover></portrait>
                </div>
            </div>
        </div>
    </panel-mode>
-->
    <panel-mode name="authorize" access="CONTRIBUTE">
        <div ng-show="children">
            <h2>People I've Authorized</h2>

            <article class="network-auth cf" bindonce ng-repeat="child in partyAuth.children">
                <div class="row">
                    <div class="col-desktop-1 col-laptop-1 col-tablet-1 col-mobile-1">
                        <figure baseline="square" class="figure_avatar" ng-click="openAuthChild(child, authForm)">
                            <figmedia><img ng-src="{{router.partyAvatar(child.party, 54)}}"></figmedia>
                        </figure>
                    </div>

                    <div class="col-desktop-14 col-laptop-11 col-tablet-8 col-mobile-5">
                        <div class="row">
                            <div class="col-desktop-14 col-laptop-11 col-tablet-8 col-mobile-5">
                                <span class="network-auth-username" bo-html="child.party.name"></span>
                                <span class="network-auth-email" bo-if="child.party.email" bo-html="child.party.email"></span>
                            </div>

                            <div ng-hide="currentAuthChild == child">
                                <div class="col-desktop-4 col-laptop-4 col-tablet-3 col-mobile-5">
                                    <div class="network-auth-heading">Access to My Data</div>
                                    <div class="network-auth-direct" bo-html="constant.data.message.authorization.direct[child.direct]"></div>
                                </div>

                                <div class="col-desktop-4 col-laptop-4 col-tablet-3 col-mobile-5">
                                    <div class="network-auth-heading">Access to Databrary</div>
                                    <div class="network-auth-inherit" bo-html="constant.data.message.authorization.inherit[child.inherit]"></div>
                                </div>

                                <div class="col-desktop-6 col-laptop-3 col-tablet-2 col-mobile-5">
                                    <div class="network-auth-heading expiration">Expiration</div>
                                    <div class="network-auth-expiration" bo-html="child.authorized | date:'longDate'"></div>
                                </div>
                            </div>

                            <div ng-if="currentAuthChild == child">
                                <div class="col-desktop-12 col-laptop-10 col-tablet-8 col-mobile-5">
                                    <form name="authForm" ng-init="initializePreset(child)">
                                        <fieldset class="clean">
                                            <legend>Grant <span bo-html="child.party.name"></span> the following capabilities:</legend>

                                            <div ng-repeat="preset in constant.data.preset">
                                                <input type="radio" name="shortcut" ng-checked="presetSelected(child, preset)" ng-click="setPreset(child, preset)">
                                                <!-- switch to ng-change + ng-model -->
                                                <label class="option" bo-html="preset.name"></label>
                                            </div>
                                        </fieldset>

                                        <div class="row">
                                            <div class="col-desktop-6 col-laptop-5 col-tablet-4 col-mobile-5">
                                                <fieldset ng-disabled="!child.preset.custom" class="boxed">
                                                    <legend>Access to My Data</legend>

                                                    <div ng-repeat="permission in constant.data.permission">
                                                        <input type = "radio" ng-model="child.direct" name="direct" ng-value="permission.id" ng-selected="permission.id == child.direct">
                                                        <label bo-html="constant.data.message.authorization.direct[permission.id]" class="option"></label>
                                                    </div>
                                                </fieldset>
                                            </div>

                                            <div class="col-desktop-6 col-laptop-5 col-tablet-4 col-mobile-5">
                                                <fieldset ng-disabled="!child.preset.custom" class="boxed">
                                                    <legend>Access to Databrary</legend>

                                                    <div ng-repeat="permission in constant.data.permission">
                                                        <input type="radio" ng-model="child.inherit" name="inherit" ng-value="permission.id" ng-selected="permission.id == child.inherit">
                                                        <label bo-html="constant.data.message.authorization.inherit[permission.id]" class="option"></label>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>

                                        <fieldset class="clean" ng-init="initializeExpiration(child)">
                                            <label>Expiration:</label>

                                            <input type="date" ng-model="child.expiration">

                                            <button ng-click="child.expiration = ''" ng-if="auth.hasAccess('ADMIN', party)" class="third">Clear expiration</button>
                                        </fieldset>

                                        <fieldset class="clean">
                                            <input type="hidden" name="id" bo-value="child.id">

                                            <button ng-click="saveAuthChild()" class="second">Update</button>
                                            <button ng-click="closeAuthChild()" class="first">Cancel</button>
                                        </fieldset>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </panel-mode>
</panel>
