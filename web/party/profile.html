<article class="view party-view">
  <ng-include src="'party/overview.html'"></ng-include>
  <panel id="panel_browser" panel-title="profile.title" fold ng-if="::party.volumes || page.models.Login.isAuthorized()" class="profile">  

    <section id="profile-volumes" class="profile-volumes col-desktop-10 col-tablet-6 col-mobile-6">
      <div ng-repeat="vl in ::volumes" ng-if="::vl.length">
        <span class="profile-section-header" ng-bind="::vl.title"></span> 
        <span class="profile-section-header" ng-if="::vl.accessLevel" tooltip="vl.tooltip">(Your access:
          <span class="icon user-access" ng-class="::vl.accessLevel"></span>
          )
        </span>
        <ul>
          <li ng-repeat="v in ::vl" ng-class="{'profile-highlight': !!v.selected}">
            <div class="profile-left-icons">
              <span ng-click="v.select()" class="icon" ng-class="v.class()"></span>
            </div>

            <a ng-href="{{::v.volume.route()}}" ng-bind="::v.volume.displayName"></a>
            <div class="profile-right-icons">
              <span class="icon" ng-if="::v.volume.accessPreset" ng-class="::'access'+v.volume.accessPreset"></span>
              <span class="icon user-access" ng-class="::page.constants.permission[v.volume.permission]"></span>
              <span class="icon" ng-class="::{'network': v.self.children}"></span>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <section id="profile-parties" class="profile-parties col-desktop-5 col-tablet-3 col-mobile-6">
      <div ng-if="::parties.parents.length">
        <span class="profile-section-header" ng-bind="::parties.parents.title"></span> 
        <ul>
          <li ng-repeat="p in ::parties.parents" ng-class="{'profile-highlight': !!p.selected}">
            <div class="profile-left-icons">
              <span ng-click="p.select()" class="icon" ng-class="p.class()"></span>
            </div>

            <a ng-href="{{::p.party.route()}}" ng-bind="::p.party.name"></a><wbr>
            <span ng-if="::!(p.parent.member || p.parent.site)" class="permission-auth-pending" message="auth.pending"></span>
            <span ng-if="::(p.parent.member || p.parent.site)" class="permission-auth-expiration" ng-bind="::p.parent.expires | date:'yyyy/MM/dd'" ng-class="isExpired(p.parent.expires)"></span>
            <br>
            <span ng-if="::!!p.parent.site" class="profile-additional">
              <span ng-bind="::'auth.site.'+page.constants.permission[p.parent.site]+'.title' | message"></span><wbr>
              <span ng-bind="::' ('+('auth.site.'+page.constants.permission[p.parent.site] | message:'their')+')'"></span>
            </span>
          </li>
        </ul>
      </div>
      <div ng-repeat="cl in ::parties.children" ng-if="::cl.length">
        <span class="profile-section-header" ng-bind="::'parties.'+cl.type+'.title' | message"></span> 
        <span class="icon info" tooltip="::'parties.'+cl.type+'.definition' | message"></span>
        <div class="profile-right-icons">
          <span class="icon network"></span>
        </div>        
        <ul>
          <li ng-repeat="p in cl" ng-class="{'profile-highlight': !!p.selected}">
            <div class="profile-left-icons">
              <span ng-click="p.select()" class="icon" ng-class="p.class()"></span>
            </div>

            <span><a ng-href="{{::p.party.route()}}" ng-bind="::p.party.name"></a></span><wbr>
            <span ng-if="::!(p.child.member || p.child.site)" class="permission-auth-pending" message="auth.pending"></span>
            <span ng-if="::(p.child.member || p.child.site)" class="permission-auth-expiration" ng-bind="::p.child.expires | date:'yyyy/MM/dd'" ng-class="isExpired(p.child.expires)"></span>

            <div class="profile-right-icons">
              <span class="icon user-access" ng-class="::page.constants.permission[p.child.member]"></span>
            </div>
          </li>
        </ul>
      </div>
      <div ng-if="::parties.collaborators.length">
        <span class="profile-section-header" ng-bind="::'parties.collaborators.title' | message"></span> 
        <span class="icon info" tooltip="::'parties.collaborators.definition' | message"></span>
        <ul>
          <li ng-repeat="p in ::parties.collaborators" ng-class="{'profile-highlight': !!p.selected}">
            <div class="profile-left-icons">
              <span ng-click="p.select()" class="icon" ng-class="p.class()"></span>
            </div>

            <a ng-href="{{::p.party.route()}}" ng-bind="::p.party.name"></a>
          </li>
        </ul>
      </div>
    </section>
  </panel>
</article>
