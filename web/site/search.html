<article class="view search-view">
  <div class="wrap">
    <div class="row">
      <div class="col">
        <h1 class="panel-title smaller">
          <span>Search </span>
          <ng-form isolate>
            <input class="search-input" type="search" ng-model="searchBoxQuery" key-enter="searchBox()"/>
          </ng-form>
        </h1>
      </div>
    </div>
    <div class="search-filters col-desktop-3 col-tablet-2 col-mobile-6">
      <!--gcwork in progress-->
      <div>
        <span>Results</span>
        <span ng-repeat="t in typeDisplay" ng-click="partyVolBoxClick_temp(t)" ng-bind="::t"></span>
      </div>

      <div>
        <span>Filter</span>
        <span ng-repeat="s in filterDisplay" ng-click="filterBoxClick()" ng-bind="::s"></span>
      </div>
      <!--gcwork in progress-->
      <select multiple="multiple" ng-model="selectedType" ng-options="t for t in typeDisplay" ng-click="partyVolBoxClick()"></select>
      <select multiple="multiple" ng-model="selectedFilter" ng-options="s for s in filterDisplay" ng-click="filterBoxClick()"></select>

      <div class="search-filter">
        <span>Age</span><br>
        <input type="text" id="age" style="border:0;box-shadow:none;">
        <div id="age-slider"></div>
      </div>

      <div class="search-filter" ng-repeat="m in selectedMetrics track by m.metric.id">
        <span class="icon trash" ng-click="returnMetric(m)"></span><span ng-bind="::m.metric.name"></span>
        <input type="text" ng-if="::!m.metric.options && m.metric.type=='text'"/>
        <input type="number" ng-if="::!m.metric.options && m.metric.type=='numeric'" />
        <input-completer ng-if="::m.metric.options" input-name="{{::m.metric.name}}" ng-model="m.value" completer="optionsCompleter($input, m.metric.options)" min="0"></input-completer>
      </div>

      <div class="additional-filters">
        <select ng-model="selectedMetric" ng-options="m.name for m in allMetrics" ng-change="updateSelectedMetrics()">
          <option value="">--additional filters--</option>
        </select>
      </div>

    </div>
    <div class="search-results col-desktop-12 col-tablet-7 col-mobile-6">
      <small class="status">{{totalCount}} results found. </small>
      <small class="status" ng-if="suggestedQuery.length > 0">
        Did you mean <a class="search-suggestion" ng-click="search(suggestedQuery)">{{suggestedQuery}}</a>?
      </small>
      <div ng-if="partyCount > 0">
        <h3>Users</h3>
        <div class="row search-party-results">
          <aside class="col-desktop-5 col-tablet-4 col-mobile-6 portrait ng-cloak" ng-repeat="result in partyModels">
            <a ng-href="{{::page.router.party([result.id])}}">
              <figure class="figure-avatar" ng-class="::{inst: party.institution}">
                <img ng-src="{{::page.router.partyAvatar([result.id, size || 56], {})}}">
              </figure>
            </a>
            <div class="portrait-info">
              <a class="portrait-name" ng-href="{{::page.router.party([result.id])}}" ng-bind="::result.prename + ' ' + result.sortname"></a>
              <span class="portrait-extra" ng-bind="::result.affiliation"></span>
            </div>
          </aside>
        </div>
      </div>
      <div ng-if="volumeCount > 0">
        <h3>Volumes</h3>
        <ul class="row search-volume-results">
          <li ng-repeat="result in volumeModels">
            <h1 class="search-volume-result-title">
              <span ng-if="retrievedContainers[result.id] === undefined" ng-click="searchContainers(result)" class="icon radio"></span>
              <span ng-if="retrievedContainers[result.id] !== undefined" ng-click="clearContainers(result)" class="icon radio-selected"></span>
              <a ng-href="volume/{{result.id}}">{{result.name}}</a>
            </h1>

            <div ng-bind="formVolumeResult(result)"></div>

            <div class="search-volume-result-keywords" ng-if="result.volume_keywords_ss.length > 0">
              <span>Keywords: </span>
              <ul class="inline-block comma">
                <li ng-repeat="k in result.tags">{{k}}</li>
              </ul>
            </div>

            <div >

            <div class="search-volume-containers" ng-if="retrievedContainers[result.id] !== undefined">
              <small class="status" ng-if="retrievedContainers[result.id].length <= 0">No matching records or assets found</small>
              <ul ng-if="retrievedContainers[result.id].length > 0">
                <li ng-repeat="container in retrievedContainers[result.id]">
                  <a ng-href="{{::page.router.slot([container.id, container.containerId, container.segment])}}?record={{container.recordId}}">Age: 
                  <span ng-if="!container.age">none</span>
                  <display-age value="container.age"></display-age> 
                  Text: {{container.text? container.text: 'none'}}</a>
                  <img ng-src="{{container.thumbRoute(240)}}">
                </li>
              </ul>
            </div>

          </li>
        </ul>
      </div>
      <div class="search-pages" ng-if="totalCount > 0">
        <span ng-if="prev">
          <a ng-if="prev" ng-click="prev()">&lt; </a>
        </span>
        <b ng-repeat="i in pageRange">
          <b ng-if="number == i">| {{i}} </b>
          <span ng-if="number != i">
            <a ng-click="goToPage(i)">| {{i}} </a>
          </span>
        </b>
        |
        <span ng-if="next">
          <a ng-click="next()"> &gt;</a>
        </span>
      </div>
    </div>
  </div>
</article>
