# Routes
# This file defines all application routes (Higher priority routes first)
# vi:et
# ~~~~

# Static content
GET     /                                                                                         controllers.Static.index
GET     /about/team                                                                               controllers.Static.team
GET     /about                                                                                    controllers.Static.page(page = "about")
GET     /about/$page<[a-z]+>                                                                      controllers.Static.page(page : String)

# users
GET     /login                                                                                    controllers.LoginHtml.view
POST    /login                                                                                    controllers.LoginHtml.post
GET     /OpenID                                                                                   controllers.LoginHtml.openID(email = "")
GET     /OpenID/$email<.+\@.+\..+>                                                                controllers.LoginHtml.openID(email : String)
# TODO: should be POST:
GET     /logout                                                                                   controllers.LoginHtml.logout
GET     /superuser/on                                                                             controllers.LoginHtml.superuserOn
GET     /superuser/off                                                                            controllers.LoginHtml.superuserOff
GET     /token/password                                                                           controllers.Token.getPassword
POST    /token/password                                                                           controllers.Token.issuePassword
GET     /token/:token                                                                             controllers.Token.token(token : String)

# parties
GET     /party/$pID<-?[0-9]+>                                                                     controllers.PartyHtml.view(pID : models.Party.Id)
GET     /party/$pID<[0-9]+>/edit                                                                  controllers.PartyHtml.edit(pID : models.Party.Id)
POST    /party/$pID<[0-9]+>/edit                                                                  controllers.PartyHtml.update(pID : models.Party.Id)
POST    /party/$pID<[0-9]+>/token                                                                 controllers.Token.password(pID : models.Account.Id)
GET     /party/$pID<[0-9]+>/authorize                                                             controllers.PartyHtml.admin(pID : models.Party.Id)
GET     /party/$pID<[0-9]+>/authorize/search/child                                                controllers.PartyHtml.authorizeSearch(pID : models.Party.Id, which : Boolean = false)
GET     /party/$pID<[0-9]+>/authorize/search/parent                                               controllers.PartyHtml.authorizeSearch(pID : models.Party.Id, which : Boolean = true)
POST    /party/$pID<[0-9]+>/authorize/$child<-?[0-9]+>                                            controllers.PartyHtml.authorizeChange(pID : models.Party.Id, child : models.Party.Id)
POST    /party/$pID<[0-9]+>/authorize/$parent<-?[0-9]+>/apply                                     controllers.PartyHtml.authorizeApply(pID : models.Party.Id, parent : models.Party.Id)
# TODO: should be POST but currently used as link:
GET     /party/$pID<[0-9]+>/authorize/$child<-?[0-9]+>/remove                                     controllers.PartyHtml.authorizeDelete(pID : models.Party.Id, child : models.Party.Id)

# volumes
GET     /search                                                                                   controllers.VolumeHtml.search
GET     /volume/create                                                                            controllers.VolumeHtml.add(owner : Option[models.Party.Id] ?= None)
POST    /volume/create/$pID<[0-9]+>                                                               controllers.VolumeHtml.create(pID : models.Party.Id)
GET     /volume/$vID<[0-9]+>                                                                      controllers.VolumeHtml.view(vID : models.Volume.Id)
GET     /volume/$vID<[0-9]+>/edit                                                                 controllers.VolumeHtml.edit(vID : models.Volume.Id)
POST    /volume/$vID<[0-9]+>/edit                                                                 controllers.VolumeHtml.update(vID : models.Volume.Id)
GET     /volume/$vID<[0-9]+>/access                                                               controllers.VolumeHtml.admin(vID : models.Volume.Id)
GET     /volume/$vID<[0-9]+>/access/search                                                        controllers.VolumeHtml.accessSearch(vID : models.Volume.Id)
# TODO: should be POST:
GET     /volume/$vID<[0-9]+>/access/$pID<-?[0-9]+>/remove                                         controllers.VolumeHtml.accessDelete(vID : models.Volume.Id, pID : models.Party.Id)
POST    /volume/$vID<[0-9]+>/access/$pID<-?[0-9]+>                                                controllers.VolumeHtml.accessChange(vID : models.Volume.Id, pID : models.Party.Id)
GET     /volume/$vID<[0-9]+>/thumb                                                                controllers.VolumeController.thumb(vID : models.Volume.Id)

# slots
POST    /volume/$vID<[0-9]+>/slot/container                                                       controllers.Slot.html.addContainer(vID : models.Volume.Id)
GET     /volume/$vID<[0-9]+>/slot/container                                                       controllers.Slot.html.createContainer(vID : models.Volume.Id)

GET     /volume/$vID<[0-9]+>/slot/$cID<[0-9]+>/slot/create                                        controllers.Slot.html.create(vID : models.Volume.Id, cID : models.Slot.Id)
POST    /volume/$vID<[0-9]+>/slot/$cID<[0-9]+>/slot/create                                        controllers.Slot.html.add(vID : models.Volume.Id, cID : models.Slot.Id)

GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>                                                    controllers.Slot.html.view(vID : models.Volume.Id, sID : models.Slot.Id)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/edit                                               controllers.Slot.html.edit(vID : models.Volume.Id, sID : models.Slot.Id)
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/edit                                               controllers.Slot.html.change(vID : models.Volume.Id, sID : models.Slot.Id)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/thumb                                              controllers.Slot.html.thumb(vID : models.Volume.Id, sID : models.Slot.Id)

# assets
GET     /volume/$vID<[0-9]+>/asset/create                                                         controllers.Asset.html.createTop(vID : models.Volume.Id)
GET     /volume/$vID<[0-9]+>/slot/$cID<[0-9]+>/asset/create                                       controllers.Asset.html.create(vID : models.Volume.Id, cID : models.Slot.Id)
POST    /volume/$vID<[0-9]+>/slot/$cID<[0-9]+>/asset/create                                       controllers.Asset.html.upload(vID : models.Volume.Id, cID : models.Slot.Id)
GET     /volume/$vID<[0-9]+>/asset/$aID<[0-9]+>                                                   controllers.Asset.html.view(vID : models.Volume.Id, aID : models.Asset.Id)
GET     /volume/$vID<[0-9]+>/asset/$aID<[0-9]+>/edit                                              controllers.Asset.html.edit(vID : models.Volume.Id, aID : models.Asset.Id)
POST    /volume/$vID<[0-9]+>/asset/$aID<[0-9]+>/edit                                              controllers.Asset.html.change(vID : models.Volume.Id, aID : models.Asset.Id)
POST    /volume/$vID<[0-9]+>/asset/$aID<[0-9]+>/remove                                            controllers.Asset.html.remove(vID : models.Volume.Id, aID : models.Asset.Id)

GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>                                 controllers.SlotAsset.view(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>/download                        controllers.SlotAsset.download(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id, inline : Boolean = false)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>/inline                          controllers.SlotAsset.download(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id, inline : Boolean = true)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>/head                            controllers.SlotAsset.head(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>/thumb                           controllers.SlotAsset.thumb(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id)
GET     /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/asset/$aID<[0-9]+>/frame/$offset<[0-9:\.]+>        controllers.SlotAsset.frame(vID : models.Volume.Id, sID : models.Slot.Id, aID : models.Asset.Id, offset : dbrary.Offset)

# annotations
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/comment/create                                     controllers.Slot.html.comment(vID : models.Volume.Id, sID : models.Slot.Id, parent : Option[models.Comment.Id] ?= None)

POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/tag                                                controllers.Slot.html.tag(vID : models.Volume.Id, sID : models.Slot.Id)

# records
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/record/$rID<[0-9]+>/remove                         controllers.Record.html.slotRemove(vID : models.Volume.Id, sID : models.Slot.Id, rID : models.Record.Id, editRedirect : Boolean = false)
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/record/$rID<[0-9]+>/remove/return                  controllers.Record.html.slotRemove(vID : models.Volume.Id, sID : models.Slot.Id, rID : models.Record.Id, editRedirect : Boolean = true)
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/record/$cID<-?[0-9]+>/create                       controllers.Record.html.slotAdd(vID : models.Volume.Id, sID : models.Slot.Id, cID : models.RecordCategory.Id, editRedirect : Boolean = false)
POST    /volume/$vID<[0-9]+>/slot/$sID<[0-9]+>/record/$cID<-?[0-9]+>/create/return                controllers.Record.html.slotAdd(vID : models.Volume.Id, sID : models.Slot.Id, cID : models.RecordCategory.Id, editRedirect : Boolean = true)

GET     /volume/$vID<[0-9]+>/record/$rID<[0-9]+>                                                  controllers.Record.html.view(vID : models.Volume.Id, rID : models.Record.Id)
GET     /volume/$vID<[0-9]+>/record/$cID<-?[0-9]+>/create                                         controllers.Record.html.add(vID : models.Volume.Id, cID : models.RecordCategory.Id)
GET     /volume/$vID<[0-9]+>/record/$rID<[0-9]+>/edit                                             controllers.Record.html.edit(vID : models.Volume.Id, rID : models.Record.Id)
POST    /volume/$vID<[0-9]+>/record/$rID<[0-9]+>/edit                                             controllers.Record.html.update(vID : models.Volume.Id, rID : models.Record.Id)

GET     /volume/$vID<[0-9]+>/ingest/csv                                                           controllers.Ingest.csv(vID : models.Volume.Id)
POST    /volume/$vID<[0-9]+>/ingest/curated                                                       controllers.Ingest.curated(vID : models.Volume.Id)

# API
GET     /api/about/$page<[a-z]+>                                                                  controllers.Static.api.page(page : String)
POST    /api/login                                                                                controllers.LoginApi.post
POST    /api/logout                                                                               controllers.LoginApi.logout
POST    /api/superuser/on                                                                         controllers.LoginApi.superuserOn
POST    /api/superuser/off                                                                        controllers.LoginApi.superuserOff

GET     /api/party/$partyId<-?[0-9]+>                                                             controllers.PartyApi.get(partyId : models.Party.Id)
POST    /api/party/$partyId<-?[0-9]+>                                                             controllers.PartyApi.update(partyId : models.Party.Id)

GET     /api/volume/$volumeId<[0-9]+>                                                             controllers.VolumeApi.get(volumeId : models.Volume.Id)
POST    /api/volume/$volumeId<[0-9]+>                                                             controllers.VolumeApi.update(volumeId : models.Volume.Id)
POST    /api/volume                                                                               controllers.VolumeApi.create(owner : models.Party.Id)

GET     /api/slot/$containerId<[0-9]+>                                                            controllers.Slot.api.get(containerId : models.Container.Id, start : Option[dbrary.Offset] ?= None, end : Option[dbrary.Offset] ?= None)

GET     /api/record/$recordId<[0-9]+>                                                             controllers.Record.api.get(recordId : models.Record.Id)
GET     /api/record                                                                               controllers.Record.api.query(volume : models.Volume.Id)

GET     /api/asset/$assetId<[0-9]+>                                                               controllers.Asset.api.get(assetId : models.Asset.Id)

# static resources
GET     /public/*file                                                                             controllers.Assets.at(path="/public", file)

# test
GET     /test                                                                                     controllers.Site.test

# redirects
GET     /p/*path                                                                                  controllers.Site.tinyUrl(path : String, prefix : String = "party")
GET     /v/*path                                                                                  controllers.Site.tinyUrl(path : String, prefix : String = "volume")
GET     /*path/                                                                                   controllers.Site.untrail(path: String)
